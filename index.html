<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>自动驾驶 + 具身智能 融合学习站（3年全套）</title>

  <!-- MathJax for LaTeX -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true
      },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1730;
      --card:#101a38;
      --line:#24304f;
      --text:#e7eaf3;
      --muted:#aab2c8;
      --accent:#72a7ff;
      --accent2:#86efac;
      --warn:#fbbf24;
      --danger:#fb7185;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Microsoft YaHei", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); background:var(--bg); color:var(--text); line-height:1.75;}
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .app{display:grid; grid-template-columns: 320px 1fr; min-height:100vh;}
    .sidebar{
      border-right:1px solid var(--line);
      background:linear-gradient(180deg, #0b1020 0%, #0b1020 60%, #0b1020 100%);
      padding:16px 14px;
      position:sticky; top:0; height:100vh; overflow:auto;
    }
    .brand{display:flex; gap:10px; align-items:center; margin-bottom:12px;}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:radial-gradient(circle at 30% 30%, var(--accent), #2b5cff 60%, #1a2a6c);
      border:1px solid var(--line);
    }
    .brand h1{font-size:14px; margin:0;}
    .brand p{font-size:12px; margin:0; color:var(--muted);}
    .search{
      margin:12px 0 10px; display:flex; gap:8px;
    }
    .search input{
      flex:1; padding:10px 10px; border-radius:12px;
      border:1px solid var(--line); background:var(--panel); color:var(--text);
      outline:none;
    }
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--line); background:rgba(114,167,255,0.08);
      color:#cfe0ff; padding:4px 10px; border-radius:999px; font-size:12px;
    }
    .metaRow{display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 6px;}
    .navGroup{margin:12px 0;}
    .navGroup .title{font-size:12px; color:var(--muted); margin:10px 6px;}
    .navItem{
      width:100%; text-align:left; cursor:pointer;
      border:1px solid transparent; background:transparent; color:var(--text);
      padding:10px 10px; border-radius:12px;
      display:flex; align-items:center; justify-content:space-between; gap:8px;
    }
    .navItem:hover{background:rgba(255,255,255,0.04); border-color:rgba(255,255,255,0.06)}
    .navItem.active{background:rgba(114,167,255,0.10); border-color:rgba(114,167,255,0.25)}
    .tag{font-size:11px; color:var(--muted)}
    .small{font-size:12px; color:var(--muted)}
    .content{
      padding:18px 18px 60px;
      max-width: 1100px;
    }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      margin-bottom:14px;
    }
    .topbar h2{margin:0; font-size:18px}
    .btnRow{display:flex; gap:10px; flex-wrap:wrap;}
    button.btn{
      cursor:pointer; border:1px solid var(--line); background:var(--panel); color:var(--text);
      padding:9px 12px; border-radius:12px; font-size:12px;
    }
    button.btn:hover{border-color:rgba(114,167,255,0.35)}
    button.btn.danger{border-color:rgba(251,113,133,0.35); background:rgba(251,113,133,0.08)}
    .grid{
      display:grid; gap:12px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .card{
      background:linear-gradient(180deg, rgba(16,26,56,1) 0%, rgba(12,18,40,1) 100%);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px 14px;
    }
    .card h3{margin:0 0 6px; font-size:14px}
    .card p{margin:6px 0; color:#d9def0}
    .muted{color:var(--muted)}
    .hr{height:1px; background:var(--line); margin:12px 0}
    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,0.02);
      padding:10px 10px;
      margin:10px 0;
    }
    summary{cursor:pointer; font-weight:600}
    .checklist{margin:8px 0 0 0; padding-left:18px}
    .checklist li{margin:6px 0}
    .checkline{display:flex; gap:10px; align-items:flex-start}
    .checkline input{margin-top:3px}
    pre{
      background:#070b16;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      overflow:auto;
      font-family:var(--mono);
      font-size:12px;
      line-height:1.55;
      color:#dbe5ff;
    }
    code{font-family:var(--mono)}
    .kbd{font-family:var(--mono); font-size:11px; border:1px solid var(--line); padding:2px 6px; border-radius:8px; color:#cfe0ff}
    .progress{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      margin:10px 0 0;
      font-size:12px; color:var(--muted);
    }
    .bar{
      width:180px; height:10px; border-radius:999px; background:#0b1227; border:1px solid var(--line);
      overflow:hidden;
    }
    .bar > div{height:100%; background:linear-gradient(90deg,var(--accent), #4ade80); width:0%;}
    .callout{
      border-left:3px solid var(--accent);
      padding:8px 10px;
      background:rgba(114,167,255,0.08);
      border-radius:12px;
      color:#dbe5ff;
      margin:10px 0;
    }
    .warn{
      border-left:3px solid var(--warn);
      background:rgba(251,191,36,0.08);
    }
    .dangerBox{
      border-left:3px solid var(--danger);
      background:rgba(251,113,133,0.08);
    }
    .twoCol{
      display:grid; gap:12px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 920px){
      .app{grid-template-columns: 1fr}
      .sidebar{position:relative; height:auto}
      .twoCol{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>融合学习站（3年全套）</h1>
        <p>自动驾驶 + 具身智能 | 公式 + 论文 + 代码</p>
      </div>
    </div>

    <div class="metaRow">
      <span class="pill">公式：MathJax</span>
      <span class="pill">进度：本地保存</span>
    </div>

    <div class="search">
      <input id="q" placeholder="搜索：IMU / ESKF / MPC / FAST-LIO / Isaac..." />
    </div>
    <div class="small muted">快捷键：<span class="kbd">Ctrl</span> + <span class="kbd">K</span> 聚焦搜索</div>

    <div class="navGroup">
      <div class="title">起步</div>
      <button class="navItem active" data-page="home">总览与使用说明 <span class="tag">Start</span></button>
      <button class="navItem" data-page="resources">教材/论文/工具索引 <span class="tag">Index</span></button>
    </div>

    <div class="navGroup">
      <div class="title">Year 1｜估计基础（定位/状态估计）</div>
      <button class="navItem" data-page="y1_m1">M1：旋转与IMU模型 <span class="tag">IMU</span></button>
      <button class="navItem" data-page="y1_m2">M2：IMU传播（p,v,R,b） <span class="tag">Prop</span></button>
      <button class="navItem" data-page="y1_m3">M3：ESKF（误差状态） <span class="tag">ESKF</span></button>
      <button class="navItem" data-page="y1_m4">M4：LIO/VIO 框架理解 <span class="tag">VINS/LIO</span></button>
      <button class="navItem" data-page="y1_m5">M5：FAST-LIO2 拆解学习 <span class="tag">FAST</span></button>
      <button class="navItem" data-page="y1_m6">M6：Autoware 定位链路 & 日志分析 <span class="tag">Autoware</span></button>
    </div>

    <div class="navGroup">
      <div class="title">Year 2｜控制/动力学/仿真（具身核心）</div>
      <button class="navItem" data-page="y2_m1">M7：运动学（FK/IK/Jacobian） <span class="tag">Kin</span></button>
      <button class="navItem" data-page="y2_m2">M8：控制入门（PID/LQR） <span class="tag">Ctrl</span></button>
      <button class="navItem" data-page="y2_m3">M9：MPC/优化基础 <span class="tag">MPC</span></button>
      <button class="navItem" data-page="y2_m4">M10：刚体动力学（M,C,g） <span class="tag">Dyn</span></button>
      <button class="navItem" data-page="y2_m5">M11：仿真（Isaac/MuJoCo/Drake） <span class="tag">Sim</span></button>
      <button class="navItem" data-page="y2_m6">M12：腿式机器人估计/接触模型（InEKF） <span class="tag">Legged</span></button>
    </div>

    <div class="navGroup">
      <div class="title">Year 3｜系统能力/高级方法/影响力</div>
      <button class="navItem" data-page="y3_m1">M13：系统工程（延迟/实时/同步） <span class="tag">Sys</span></button>
      <button class="navItem" data-page="y3_m2">M14：高级估计（Invariant EKF/因子图） <span class="tag">AdvEst</span></button>
      <button class="navItem" data-page="y3_m3">M15：WBC/接触力优化（腿式核心） <span class="tag">WBC</span></button>
      <button class="navItem" data-page="y3_m4">M16：端到端/学习控制入门（选修） <span class="tag">RL</span></button>
      <button class="navItem" data-page="y3_m5">M17：作品集/面试素材/技术影响力 <span class="tag">Career</span></button>
    </div>

    <div class="navGroup">
      <div class="title">工具</div>
      <button class="navItem" data-page="tracker">进度与打卡 <span class="tag">Track</span></button>
    </div>

    <div class="hr"></div>
    <div class="small muted">
      说明：本页内容会持续可用；勾选进度保存在浏览器本地（localStorage）。<br/>
      如果你想把它部署到 GitHub Pages，我也可以给你部署步骤。
    </div>
  </aside>

  <!-- Content -->
  <main class="content">
    <div class="topbar">
      <h2 id="pageTitle">总览与使用说明</h2>
      <div class="btnRow">
        <button class="btn" id="expandAll">展开全部</button>
        <button class="btn" id="collapseAll">折叠全部</button>
        <button class="btn danger" id="resetProgress">清空进度</button>
      </div>
    </div>

    <div id="root"></div>
  </main>
</div>

<script>
  // ---------- Utilities ----------
  const $ = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
  const storageKey = "fusion_learning_progress_v1";

  function loadProgress(){
    try { return JSON.parse(localStorage.getItem(storageKey) || "{}"); }
    catch(e){ return {}; }
  }
  function saveProgress(p){ localStorage.setItem(storageKey, JSON.stringify(p)); }
  function setChecked(id, val){
    const p = loadProgress();
    p[id] = !!val;
    saveProgress(p);
  }
  function isChecked(id){
    const p = loadProgress();
    return !!p[id];
  }
  function escapeHtml(s){
    return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function renderChecklist(items){
    // items: [{id,text}]
    const lis = items.map(it => {
      const checked = isChecked(it.id) ? "checked" : "";
      return `
        <li>
          <label class="checkline">
            <input type="checkbox" data-check="${it.id}" ${checked}/>
            <span>${it.text}</span>
          </label>
        </li>`;
    }).join("");
    return `<ul class="checklist">${lis}</ul>`;
  }
  function computeCompletion(prefix){
    // count all ids starting with prefix in DOM or dataset pages
    const all = [];
    for (const [k, v] of Object.entries(ALL_TASK_IDS)){
      if (k.startsWith(prefix)) all.push(k);
    }
    if (!all.length) return {done:0,total:0,rate:0};
    const done = all.filter(id => isChecked(id)).length;
    const total = all.length;
    const rate = Math.round(done/total*100);
    return {done,total,rate};
  }

  // ---------- Resource Links (authoritative) ----------
  const LINKS = {
    barfootBook: "https://www.cambridge.org/core/books/state-estimation-for-robotics/00E53274A2F1E6CC1A55CA5C3D1C9718",
    barfootPdf:  "https://asrl.utias.utoronto.ca/~tdb/bib/barfoot_ser24.pdf",
    solaESKF:    "https://arxiv.org/abs/1711.02508",
    vinsMono:    "https://arxiv.org/abs/1708.03852",
    fastlio:     "https://github.com/hku-mars/FAST_LIO",
    fastlioPdf:  "https://raw.githubusercontent.com/hku-mars/FAST_LIO/main/doc/Fast_LIO_2.pdf",
    liosam:      "https://github.com/TixiaoShan/LIO-SAM",
    underact:    "https://underactuated.csail.mit.edu/index.html",
    underactOCW: "https://ocw.mit.edu/courses/6-832-underactuated-robotics-spring-2022/",
    modernRob:   "https://modernrobotics.northwestern.edu/nu-gm-book-resource/",
    isaacDocs:   "https://docs.isaacsim.omniverse.nvidia.com/",
    isaacDev:    "https://developer.nvidia.com/isaac/sim",
    mujocoSite:  "https://mujoco.org/",
    mujocoDocs:  "https://mujoco.readthedocs.io/",
    drake:       "https://drake.mit.edu/",
    drakeDocs:   "https://drake.mit.edu/doxygen_cxx/",
    autowareUni: "https://autowarefoundation.github.io/autoware_universe/main/",
    autowareDoc: "https://autowarefoundation.github.io/autoware-documentation/main/home/",
    inekf2019:   "https://arxiv.org/abs/1904.09251",
    inekf2018:   "https://arxiv.org/abs/1805.10410",
  };

  // ---------- Task IDs for progress accounting ----------
  const ALL_TASK_IDS = {};
  function addTaskIds(prefix, items){
    for (const it of items) ALL_TASK_IDS[it.id] = true;
  }

  // ---------- Page Definitions ----------
  const PAGES = {};

  // Home
  PAGES.home = {
    title: "总览与使用说明",
    render(){
      return `
      <div class="card">
        <h3>你将用这个网页学到什么</h3>
        <p>目标：<b>自动驾驶 + 具身智能 融合工程师</b>（估计 + 控制 + 系统）。这份网页把三年内容拆成模块（Month/Module），每个模块都有：<b>学什么 → 公式 → 代码骨架 → 论文/教材 → 实操任务</b>。</p>
        <div class="callout">
          <b>正确学习循环：</b>读论文/教材 → 推导关键公式 → 写最小可跑代码 → 仿真验证 → 结合实车/日志复盘。
        </div>
        <div class="warn callout">
          <b>避免误区：</b>只刷论文不写代码、只写代码不做误差分析、学太散不形成闭环。
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>三年主线（只抓这3条）</h3>
          <ul class="checklist">
            <li><b>状态估计</b>：IMU → ESKF → LIO/VIO → Invariant EKF</li>
            <li><b>控制</b>：PID/LQR → MPC/优化 → Whole-Body Control</li>
            <li><b>系统能力</b>：实时/同步/延迟/资源 → 可部署、可维护、可排障</li>
          </ul>
        </div>

        <div class="card">
          <h3>如何用这个网页学习</h3>
          <ul class="checklist">
            <li>按左侧顺序学习：Year1 → Year2 → Year3</li>
            <li>每个模块至少完成：<b>1个最小代码</b> + <b>1个验证实验</b></li>
            <li>用“进度与打卡”页记录完成度（自动保存）</li>
            <li>遇到难点：复制公式/代码片段做小实验，失败也要记录</li>
          </ul>
        </div>
      </div>

      <div class="card">
        <h3>建议节奏（适合上班+学习）</h3>
        <div class="twoCol">
          <div>
            <p class="muted"><b>工作日</b>（2–3h）：</p>
            <ul class="checklist">
              <li>30–45min：读教材/论文（只抓公式）</li>
              <li>60–90min：写代码（最小可跑）</li>
              <li>15min：复盘记录（错误原因/下一步）</li>
            </ul>
          </div>
          <div>
            <p class="muted"><b>周末</b>（4–8h）：</p>
            <ul class="checklist">
              <li>做仿真/跑数据集</li>
              <li>写实验报告：误差曲线 + 结论</li>
              <li>把本周产出整理成“作品集”素材</li>
            </ul>
          </div>
        </div>
      </div>
      `;
    }
  };

  // Resources index
  PAGES.resources = {
    title: "教材/论文/工具索引",
    render(){
      return `
      <div class="card">
        <h3>权威教材（优先级从高到低）</h3>
        <ul class="checklist">
          <li><a href="${LINKS.barfootBook}" target="_blank" rel="noreferrer">State Estimation for Robotics（Barfoot）</a>（推荐配合PDF草稿学习）</li>
          <li><a href="${LINKS.barfootPdf}" target="_blank" rel="noreferrer">Barfoot 书稿 PDF（UTIAS）</a></li>
          <li><a href="${LINKS.modernRob}" target="_blank" rel="noreferrer">Modern Robotics（Lynch & Park）</a>（运动学/动力学/规划/控制）</li>
          <li><a href="${LINKS.underact}" target="_blank" rel="noreferrer">Underactuated Robotics（Tedrake）</a>（控制/最优化/动力学）</li>
        </ul>
      </div>

      <div class="grid">
        <div class="card">
          <h3>估计（必读论文/项目）</h3>
          <ul class="checklist">
            <li><a href="${LINKS.solaESKF}" target="_blank" rel="noreferrer">Quaternion kinematics for the error-state Kalman filter（Solà）</a></li>
            <li><a href="${LINKS.vinsMono}" target="_blank" rel="noreferrer">VINS-Mono（Qin et al.）</a></li>
            <li><a href="${LINKS.fastlio}" target="_blank" rel="noreferrer">FAST-LIO（GitHub）</a> / <a href="${LINKS.fastlioPdf}" target="_blank" rel="noreferrer">FAST-LIO2 PDF</a></li>
            <li><a href="${LINKS.liosam}" target="_blank" rel="noreferrer">LIO-SAM（GitHub）</a></li>
            <li><a href="${LINKS.inekf2019}" target="_blank" rel="noreferrer">Contact-aided InEKF（arXiv:1904.09251）</a></li>
          </ul>
        </div>

        <div class="card">
          <h3>仿真/工具（具身必备）</h3>
          <ul class="checklist">
            <li><a href="${LINKS.isaacDocs}" target="_blank" rel="noreferrer">NVIDIA Isaac Sim 文档</a> / <a href="${LINKS.isaacDev}" target="_blank" rel="noreferrer">产品页</a></li>
            <li><a href="${LINKS.mujocoSite}" target="_blank" rel="noreferrer">MuJoCo 官网</a> / <a href="${LINKS.mujocoDocs}" target="_blank" rel="noreferrer">MuJoCo 文档</a></li>
            <li><a href="${LINKS.drake}" target="_blank" rel="noreferrer">Drake</a> / <a href="${LINKS.drakeDocs}" target="_blank" rel="noreferrer">Drake 文档</a></li>
          </ul>
        </div>

        <div class="card">
          <h3>自动驾驶系统（你工作直接相关）</h3>
          <ul class="checklist">
            <li><a href="${LINKS.autowareDoc}" target="_blank" rel="noreferrer">Autoware Documentation</a></li>
            <li><a href="${LINKS.autowareUni}" target="_blank" rel="noreferrer">Autoware Universe Documentation</a></li>
          </ul>
        </div>
      </div>

      <div class="card">
        <h3>建议你的“必做作品集”（三年核心产出）</h3>
        <ul class="checklist">
          <li>作品1：IMU-ESKF 最小实现 + 数据验证（误差曲线）</li>
          <li>作品2：LIO/VIO 复现（EuRoC/KITTI/自采数据）+ 故障分析</li>
          <li>作品3：控制（PID/LQR/MPC）仿真对比 + 参数整定报告</li>
          <li>作品4：Isaac/MuJoCo 四足基础控制 + 状态估计融合</li>
          <li>作品5：系统工程：时延/同步/资源分析 + 可部署脚本</li>
        </ul>
      </div>
      `;
    }
  };

  // ---------- Module Template Helper ----------
  function modulePage({title, prefix, goals, learn, formulas, code, papers, tasks, pitfalls, next}){
    addTaskIds(prefix, tasks);
    const prog = computeCompletion(prefix);
    return {
      title,
      render(){
        const prog2 = computeCompletion(prefix);
        const barWidth = `${prog2.rate}%`;
        const taskHtml = renderChecklist(tasks);
        const paperHtml = papers.map(p => `<li><a href="${p.url}" target="_blank" rel="noreferrer">${escapeHtml(p.name)}</a> <span class="muted">— ${escapeHtml(p.note||"")}</span></li>`).join("");
        const learnHtml = learn.map(x => `<li>${x}</li>`).join("");
        const goalHtml = goals.map(x => `<li>${x}</li>`).join("");
        const pitHtml = (pitfalls||[]).map(x => `<li>${x}</li>`).join("");
        return `
          <div class="card">
            <h3>${escapeHtml(title)}</h3>
            <p class="muted">模块完成度：${prog2.done}/${prog2.total}（${prog2.rate}%）</p>
            <div class="progress">
              <div class="bar"><div style="width:${barWidth}"></div></div>
              <span>勾选任务会自动保存到本地</span>
            </div>
          </div>

          <div class="grid">
            <div class="card">
              <h3>学习目标</h3>
              <ul class="checklist">${goalHtml}</ul>
            </div>
            <div class="card">
              <h3>你要学什么（知识点清单）</h3>
              <ul class="checklist">${learnHtml}</ul>
            </div>
          </div>

          <details open>
            <summary>关键公式（理解 + 会用）</summary>
            <div class="hr"></div>
            ${formulas}
          </details>

          <details open>
            <summary>代码骨架（最小可跑）</summary>
            <div class="hr"></div>
            ${code}
          </details>

          <details>
            <summary>论文/教材/官方文档（按顺序读）</summary>
            <div class="hr"></div>
            <ul class="checklist">${paperHtml}</ul>
          </details>

          <details open>
            <summary>本模块必须完成的任务（可打勾）</summary>
            <div class="hr"></div>
            ${taskHtml}
          </details>

          <details>
            <summary>工程坑点（你工作中一定会遇到）</summary>
            <div class="hr"></div>
            <ul class="checklist">${pitHtml || "<li>暂无</li>"}</ul>
          </details>

          ${next ? `<div class="card"><h3>下一步</h3><p>${next}</p></div>` : ""}
        `;
      }
    }
  }

  // ---------- Year 1 Modules ----------
  PAGES.y1_m1 = modulePage({
    title:"Year1-M1：旋转与 IMU 模型（必修）",
    prefix:"y1_m1_",
    goals:[
      "明确 IMU 测的是什么（gyro/acc 的物理意义）",
      "掌握旋转表示（R / quaternion / Lie）并能做姿态更新",
      "能解释：为什么静止加速度计读到 9.81"
    ],
    learn:[
      "坐标系：world/body，右手系约定",
      "旋转矩阵/四元数/欧拉角（优缺点）",
      "反对称矩阵 ω^ 与 Exp(·)",
      "IMU 测量模型：bias + noise + specific force",
      "姿态离散更新（小角度近似 vs 精确）"
    ],
    formulas:`
      <div class="callout">
        <b>陀螺仪：</b> \\(\\omega_m = \\omega + b_g + n_g\\) <br/>
        <b>加速度计（比力）：</b> \\(a_m = R^\\top (a - g) + b_a + n_a\\)
      </div>

      \\[
        \\omega^\\wedge =
        \\begin{bmatrix}
        0 & -\\omega_z & \\omega_y\\\\
        \\omega_z & 0 & -\\omega_x\\\\
        -\\omega_y & \\omega_x & 0
        \\end{bmatrix}
      \\]

      \\[
        \\dot{R} = R\\,\\omega^\\wedge
        \\qquad
        R_{k+1} = R_k\\exp(\\omega^\\wedge\\Delta t)
      \\]

      \\[
        \\Delta\\theta = \\omega\\Delta t,
        \\quad
        \\delta q \\approx \\begin{bmatrix}1 \\\\ \\tfrac12\\Delta\\theta\\end{bmatrix},
        \\quad
        q_{k+1} = q_k \\otimes \\delta q,
        \\quad
        q \\leftarrow \\frac{q}{\\|q\\|}
      \\]
    `,
    code:`
<pre><code>#include &lt;Eigen/Dense&gt;
#include &lt;Eigen/Geometry&gt;

Eigen::Quaterniond UpdateQuat(const Eigen::Quaterniond&amp; q,
                              const Eigen::Vector3d&amp; omega, double dt){
  Eigen::Vector3d dtheta = omega * dt;
  Eigen::Quaterniond dq(1.0,
                        0.5*dtheta.x(),
                        0.5*dtheta.y(),
                        0.5*dtheta.z());
  return (q * dq).normalized();
}</code></pre>
    `,
    papers:[
      {name:"Barfoot — State Estimation for Robotics（书）", url:LINKS.barfootBook, note:"估计体系结构 + 旋转/误差建模"},
      {name:"Solà — Quaternion kinematics for ESKF（arXiv）", url:LINKS.solaESKF, note:"ESKF 旋转误差最经典教程"},
    ],
    tasks:[
      {id:"y1_m1_t1", text:"写一个小程序：输入恒定 ωz，积分 10s，yaw 是否 ≈ ωz·t（对比误差）"},
      {id:"y1_m1_t2", text:"加入 gyro bias：ωm=ω+bg，观察 yaw 漂移；写出漂移速度估计"},
      {id:"y1_m1_t3", text:"静止 IMU：用加速度估计重力方向（初始化姿态）并解释为什么"},
    ],
    pitfalls:[
      "忘记四元数归一化导致数值漂移",
      "世界系重力方向定义混乱（z-up / z-down）",
      "把加速度计当成“世界加速度”，忽略 specific force",
    ],
    next:"继续 M2：把姿态更新扩展为完整 IMU 传播（p,v,q,b）。"
  });

  PAGES.y1_m2 = modulePage({
    title:"Year1-M2：IMU 传播（p,v,R,b）",
    prefix:"y1_m2_",
    goals:[
      "写出并实现：姿态、速度、位置的 IMU 传播",
      "理解 bias 对积分漂移的影响",
      "为 ESKF 做好“名义状态传播”代码"
    ],
    learn:[
      "名义状态：p, v, q(R), ba, bg",
      "去 bias：ω=ωm-bg, ab=am-ba",
      "把机体系加速度转到世界系：aw=R*ab+g",
      "离散积分：v,p 更新",
      "数值稳定与时间戳管理"
    ],
    formulas:`
      \\[
        \\omega = \\omega_m - b_g,
        \\quad
        a_b = a_m - b_a,
        \\quad
        a_w = R a_b + g
      \\]
      \\[
        v_{k+1} = v_k + a_w\\Delta t
      \\]
      \\[
        p_{k+1} = p_k + v_k\\Delta t + \\tfrac12 a_w\\Delta t^2
      \\]
    `,
    code:`
<pre><code>struct Nominal {
  Eigen::Vector3d p = Eigen::Vector3d::Zero();
  Eigen::Vector3d v = Eigen::Vector3d::Zero();
  Eigen::Quaterniond q = Eigen::Quaterniond::Identity(); // world_R_body
  Eigen::Vector3d ba = Eigen::Vector3d::Zero();
  Eigen::Vector3d bg = Eigen::Vector3d::Zero();
};

void Propagate(Nominal&amp; X,
               const Eigen::Vector3d&amp; acc_m,
               const Eigen::Vector3d&amp; gyro_m,
               double dt)
{
  Eigen::Vector3d omega = gyro_m - X.bg;
  Eigen::Vector3d acc_b = acc_m  - X.ba;

  X.q = UpdateQuat(X.q, omega, dt);
  Eigen::Matrix3d R = X.q.toRotationMatrix();

  Eigen::Vector3d g(0, 0, -9.81); // 例：z-up world
  Eigen::Vector3d acc_w = R * acc_b + g;

  X.p = X.p + X.v * dt + 0.5 * acc_w * dt * dt;
  X.v = X.v + acc_w * dt;
}</code></pre>
    `,
    papers:[
      {name:"Barfoot（估计中的 IMU 模型/传播）", url:LINKS.barfootPdf, note:"书稿里 IMU 部分写得很系统"},
      {name:"Solà（ESKF 旋转误差与实现细节）", url:LINKS.solaESKF, note:"建议边读边写代码"},
    ],
    tasks:[
      {id:"y1_m2_t1", text:"跑一段 IMU 数据（可用公开数据集或自采）：只做传播，不做更新，观察 p/v 漂移曲线"},
      {id:"y1_m2_t2", text:"写一个脚本画出：|v|、yaw、p 的漂移随时间变化"},
      {id:"y1_m2_t3", text:"实现“静止检测”并估计 bias 的粗略策略（例如均值/阈值）"},
    ],
    pitfalls:[
      "dt 错（时间戳不单调/单位错）会直接炸",
      "重力方向没对齐导致速度发散",
      "加速度单位（m/s^2）与角速度（rad/s）混用",
    ],
    next:"继续 M3：ESKF（误差状态）推导 + Jacobian + 完整滤波框架。"
  });

  PAGES.y1_m3 = modulePage({
    title:"Year1-M3：ESKF（误差状态卡尔曼滤波）",
    prefix:"y1_m3_",
    goals:[
      "明确：名义状态 vs 误差状态",
      "会写：预测 P = FPF^T + Q，更新 K, x, P",
      "把 IMU 传播 + 外部观测（如 LiDAR/视觉）融合起来"
    ],
    learn:[
      "误差状态：δp, δv, δθ, δba, δbg",
      "小扰动：R ≈ R̂ Exp(δθ^)",
      "线性化：F, G, Q 的含义",
      "观测更新：残差 r=z-h(x̂)，Jacobian H",
      "数值实现：Joseph 形式、对称化"
    ],
    formulas:`
      <div class="callout">
        <b>预测：</b> \\(P = FPF^\\top + Q\\) <br/>
        <b>更新：</b> \\(K = PH^\\top (HPH^\\top + R)^{-1}\\),
        \\(\\delta x = K\\,r\\),
        \\(P = (I-KH)P(I-KH)^\\top + KRK^\\top\\)（Joseph）
      </div>
      \\[
        R \\approx \\hat{R}\\exp(\\delta\\theta^\\wedge),
        \\quad
        \\text{inject： } \\hat{R} \\leftarrow \\hat{R}\\exp(\\delta\\theta^\\wedge)
      \\]
    `,
    code:`
<pre><code>// 这里只给“骨架”。你实现时把 F,G,Q,H,r 填好。
// Tip：先做一个简单观测，比如“已知某时刻的外部位置 p_meas”。
struct ESKF {
  Nominal X;
  Eigen::MatrixXd P;

  void predict(const Eigen::Vector3d&amp; acc_m, const Eigen::Vector3d&amp; gyro_m, double dt){
    Propagate(X, acc_m, gyro_m, dt);
    // TODO: build F, Q (or F,G,Q)
    // P = F * P * F.transpose() + Q;
  }

  void updatePosition(const Eigen::Vector3d&amp; p_meas, const Eigen::Matrix3d&amp; R_meas){
    // residual r = p_meas - X.p
    // H = [I 0 0 0 0]
    // K = P H^T (H P H^T + R)^-1
    // dx = K r
    // inject nominal: p,v,q,ba,bg
    // update covariance (Joseph form recommended)
  }
};</code></pre>
    `,
    papers:[
      {name:"Solà — ESKF 教程（必读）", url:LINKS.solaESKF, note:"误差状态与旋转注入讲得最清楚"},
      {name:"Barfoot — 估计体系（KF/ESKF/Batch）", url:LINKS.barfootBook, note:"建立完整估计观"},
    ],
    tasks:[
      {id:"y1_m3_t1", text:"实现一个最小 ESKF：外部观测为 position（p_meas），跑起来并画出 P 对角线变化"},
      {id:"y1_m3_t2", text:"加入 gyro/acc noise 的 Q，验证：噪声变大 → P 增长更快"},
      {id:"y1_m3_t3", text:"做一次“故障注入”：时间戳错/单位错/重力错，并写出你如何定位问题"},
    ],
    pitfalls:[
      "旋转误差注入方式错误（用加法直接加 quaternion 是大坑）",
      "协方差更新不对称/非正定导致滤波崩溃",
      "观测 Jacobian H 写错导致发散",
    ],
    next:"继续 M4：把 ESKF 放进 LIO/VIO 框架里，理解 FAST-LIO/VINS 的结构。"
  });

  PAGES.y1_m4 = modulePage({
    title:"Year1-M4：LIO/VIO 框架理解（从论文到代码）",
    prefix:"y1_m4_",
    goals:[
      "理解：滤波式（ESKF/IEKF） vs 优化式（滑窗/因子图）",
      "掌握 LIO/VIO 典型模块：预积分、特征/点云处理、更新",
      "能解释：为何某些系统选择滤波，某些选择优化"
    ],
    learn:[
      "VIO：IMU 预积分、滑窗优化（VINS-Mono 思想）",
      "LIO：点云匹配/误差项、迭代 EKF（FAST-LIO2 思想）",
      "退化场景、时间同步、外参标定",
      "误差度量：ATE/RMSE，轨迹对齐"
    ],
    formulas:`
      <div class="callout">
        <b>你需要会讲清楚：</b><br/>
        滤波：在线递推，状态维度固定；优化：批量/滑窗，能更好处理非线性但更重。<br/>
        两者都离不开 IMU 模型和误差建模。
      </div>
    `,
    code:`
<pre><code>// 建议你做“阅读代码的提纲”：
// 1) 数据入口（IMU/LiDAR/Camera）
// 2) 时间同步与缓存（buffer）
// 3) 传播（propagate）
// 4) 构建观测（residual/Jacobian）
// 5) 更新（update）
// 6) 输出与评估（pose/path）
</code></pre>
    `,
    papers:[
      {name:"VINS-Mono（arXiv）", url:LINKS.vinsMono, note:"优化式滑窗 VIO 经典"},
      {name:"FAST-LIO（GitHub）", url:LINKS.fastlio, note:"滤波式 LIO 工程实现"},
      {name:"FAST-LIO2 PDF", url:LINKS.fastlioPdf, note:"论文结构化理解"},
      {name:"LIO-SAM（GitHub）", url:LINKS.liosam, note:"因子图/平滑与建图路线"},
    ],
    tasks:[
      {id:"y1_m4_t1", text:"画一张 LIO/VIO 系统框图（数据流：IMU→传播→观测→更新→输出）"},
      {id:"y1_m4_t2", text:"选一个系统（FAST-LIO 或 VINS），写出它“状态定义”和“观测是什么”"},
      {id:"y1_m4_t3", text:"用公开数据集跑一次（只需跑通），记录失败点与日志定位方法"},
    ],
    pitfalls:[
      "只背结论不理解观测残差来自哪里",
      "忽略外参/时间偏差，导致看起来像算法不行其实是工程问题",
    ],
    next:"继续 M5：FAST-LIO2 拆到每个函数/模块，你要能改、能排障。"
  });

  PAGES.y1_m5 = modulePage({
    title:"Year1-M5：FAST-LIO2 拆解学习（你已开始，继续深挖）",
    prefix:"y1_m5_",
    goals:[
      "能读懂 FAST-LIO2：状态/传播/更新/点云处理",
      "能定位常见问题：点云跳变、IMU 激烈运动、退化",
      "能做一个小改动并验证（参数/鲁棒性）"
    ],
    learn:[
      "状态与误差定义（iterated EKF）",
      "点云特征/残差如何构建（ICP-like）",
      "退化与鲁棒：权重、门限、迭代停止条件",
      "工程：时间同步、外参、坐标系"
    ],
    formulas:`
      <div class="callout">
        FAST-LIO2 本质：<b>IMU 传播 + 迭代EKF 用点云残差纠偏</b>。<br/>
        你要能回答：残差 r 是什么？Jacobian H 从哪来？迭代为什么能收敛？
      </div>
    `,
    code:`
<pre><code>// 你要做的“最小重构”：
// 1) 把 IMU propagate 独立成模块（你自己的库）
// 2) 把 point residual + Jacobian 独立成模块
// 3) 写一个迭代 EKF 更新循环（停止条件、鲁棒核可插拔）</code></pre>
    `,
    papers:[
      {name:"FAST-LIO（GitHub）", url:LINKS.fastlio, note:"源码与README"},
      {name:"FAST-LIO2 PDF", url:LINKS.fastlioPdf, note:"建议先读论文结构再看代码"},
      {name:"Barfoot（误差与鲁棒/离群）", url:LINKS.barfootBook, note:"把鲁棒估计补齐"},
    ],
    tasks:[
      {id:"y1_m5_t1", text:"写一份 FAST-LIO2 读码笔记：状态、传播、观测、更新、输出分别在哪些文件/函数"},
      {id:"y1_m5_t2", text:"复现一个问题：激烈运动/IMU突变时的轨迹抖动，并写出你认为的原因链"},
      {id:"y1_m5_t3", text:"做一个小改动（例如门限/权重/迭代次数）并对比 ATE 或稳定性"},
    ],
    pitfalls:[
      "把所有失败归因于算法而不是外参/时间戳/坐标",
      "不做误差度量（只看“看起来对”）",
    ],
    next:"继续 M6：把这一套迁移到 Autoware 的定位链路里，变成你工作中的可用能力。"
  });

  PAGES.y1_m6 = modulePage({
    title:"Year1-M6：Autoware 定位链路 & 日志分析（工作直接收益）",
    prefix:"y1_m6_",
    goals:[
      "把估计理论落地到 Autoware：看懂模块/参数/数据流",
      "形成排障能力：定位跳变、延迟、时间同步、外参",
      "能输出一份“定位问题分析报告”（你升职/转岗的硬通货）"
    ],
    learn:[
      "Autoware 架构与定位相关节点",
      "ROS2 数据流、topic、TF、时间同步",
      "日志解析与误差评估（RMSE/漂移/跳变）",
      "版本管理：实验可复现"
    ],
    formulas:`
      \\[
        e_p = \\sqrt{(x-x_{gt})^2 + (y-y_{gt})^2 + (z-z_{gt})^2}
      \\]
      <div class="callout">
        报告最重要的不是“我觉得”，而是：<b>曲线 + 触发条件 + 证据链</b>。
      </div>
    `,
    code:`
<pre><code>// 推荐你做一个“定位分析小工具”最小版本：
// 输入：bag/log + ground truth(可选)
// 输出：轨迹图、误差曲线、异常片段定位（按时间索引）
// 技术：Python/CPP 都行，关键是“可复现 + 可对比”。</code></pre>
    `,
    papers:[
      {name:"Autoware Documentation", url:LINKS.autowareDoc, note:"架构与教程"},
      {name:"Autoware Universe Documentation", url:LINKS.autowareUni, note:"具体模块细节"},
    ],
    tasks:[
      {id:"y1_m6_t1", text:"画出你车上定位链路数据流（传感器→节点→TF→输出）"},
      {id:"y1_m6_t2", text:"做一份定位跳变问题报告：触发条件、证据、根因猜想、验证实验"},
      {id:"y1_m6_t3", text:"建立可复现实验流程：版本号 + 参数 + 数据 + 结果图（一次就够）"},
    ],
    pitfalls:[
      "没有版本/参数记录导致无法复现",
      "只看单点截图不看时间序列",
      "时间同步（clock/source）问题没排查就调算法",
    ],
    next:"Year2 开始进入具身核心：运动学 + 控制 + 动力学 + 仿真。"
  });

  // ---------- Year 2 Modules ----------
  PAGES.y2_m1 = modulePage({
    title:"Year2-M7：运动学（FK/IK/Jacobian）",
    prefix:"y2_m1_",
    goals:[
      "掌握 FK/IK/Jacobian 基础（腿式/机械臂都通用）",
      "能在仿真里用 IK 控制末端轨迹",
      "理解：速度映射 v = J(q) qdot"
    ],
    learn:[
      "齐次变换 T ∈ SE(3)",
      "正运动学：链式乘积",
      "雅可比：关节速度到末端速度",
      "IK：数值迭代（Jacobian transpose / pseudo-inverse）",
    ],
    formulas:`
      \\[
        T = T_1 T_2 \\cdots T_n
      \\]
      \\[
        v = J(q)\\dot{q}
      \\]
      \\[
        \\dot{q} = J^\\dagger v
      \\]
    `,
    code:`
<pre><code>// IK 数值迭代伪代码（你可以在 MuJoCo/Isaac 里实现）
repeat:
  e = x_des - x(q)
  J = jacobian(q)
  dq = alpha * J^T * e   (or J^dagger * e)
  q = q + dq
until ||e|| small</code></pre>
    `,
    papers:[
      {name:"Modern Robotics（网站资源）", url:LINKS.modernRob, note:"运动学/雅可比/IK 系统教程"},
    ],
    tasks:[
      {id:"y2_m1_t1", text:"实现一个平面2-DOF机械臂 FK + 数值 IK（Python或C++）"},
      {id:"y2_m1_t2", text:"在仿真里控制末端走圆轨迹并记录误差"},
      {id:"y2_m1_t3", text:"写一页总结：Jacobian 的物理意义 + 什么时候会奇异"},
    ],
    pitfalls:[
      "把姿态误差当成欧式误差（SO(3) 上要注意）",
      "IK 迭代步长不当导致发散",
    ],
    next:"继续 M8：控制入门（PID/LQR）并和自动驾驶控制建立迁移。"
  });

  PAGES.y2_m2 = modulePage({
    title:"Year2-M8：控制入门（PID/LQR）",
    prefix:"y2_m2_",
    goals:[
      "能调 PID（并解释每项作用）",
      "掌握线性系统与 LQR（会推到 u=-Kx）",
      "做一套对比实验：PID vs LQR"
    ],
    learn:[
      "误差 e、积分、微分的物理含义",
      "线性化：x(k+1)=Ax+Bu",
      "代价函数：Σ(x^TQx+u^TRu)",
      "Riccati 与反馈增益 K"
    ],
    formulas:`
      \\[
        u = K_p e + K_i\\int e\\,dt + K_d\\frac{de}{dt}
      \\]
      \\[
        x_{k+1} = Ax_k + Bu_k
      \\]
      \\[
        J = \\sum (x_k^TQx_k + u_k^TRu_k),\\quad u=-Kx
      \\]
    `,
    code:`
<pre><code>// PID：你至少做一个二阶系统（质量-弹簧-阻尼）或 1D 速度控制
// LQR：用离散系统 A,B,Q,R 调用求解器或自己写 Riccati 迭代</code></pre>
    `,
    papers:[
      {name:"Underactuated Robotics（控制/动力学）", url:LINKS.underact, note:"控制讲解非常强"},
      {name:"MIT OCW Underactuated（课程页）", url:LINKS.underactOCW, note:"可配视频学习"},
    ],
    tasks:[
      {id:"y2_m2_t1", text:"实现一个 PID 控制器，记录超调/稳态误差/调参过程"},
      {id:"y2_m2_t2", text:"实现 LQR（离散），对比 PID 的指标"},
      {id:"y2_m2_t3", text:"写一页总结：Q/R 如何影响 K 与控制行为"},
    ],
    pitfalls:[
      "不定义指标（超调、收敛时间、稳态误差）导致调参靠感觉",
      "线性化点不对导致 LQR 在大范围失效",
    ],
    next:"继续 M9：MPC/优化（具身与自动驾驶都非常关键）。"
  });

  PAGES.y2_m3 = modulePage({
    title:"Year2-M9：MPC/优化基础",
    prefix:"y2_m3_",
    goals:[
      "理解 MPC 本质：带约束的滚动优化",
      "会写一个小 MPC（1D/2D）",
      "知道如何选预测时域、约束与代价"
    ],
    learn:[
      "优化目标与约束：状态/输入/接触力",
      "QP/非线性优化基础概念",
      "滚动时域（receding horizon）",
      "数值稳定与实时性"
    ],
    formulas:`
      \\[
        \\min \\sum (x_k-x_{ref})^TQ(x_k-x_{ref}) + u_k^TRu_k
      \\]
      \\[
        \\text{s.t. } x_{k+1}=f(x_k,u_k),\\; u\\in\\mathcal{U},\\; x\\in\\mathcal{X}
      \\]
    `,
    code:`
<pre><code>// 最小 MPC 建议：
// 1) 线性系统 + QP（最简单，先跑通）
// 2) 加输入约束 u_min/u_max
// 3) 做轨迹跟踪：x_ref(t)</code></pre>
    `,
    papers:[
      {name:"Underactuated Robotics（MPC/优化章节）", url:LINKS.underact, note:"建议从线性 MPC 起步"},
    ],
    tasks:[
      {id:"y2_m3_t1", text:"实现线性 MPC（QP）并加输入约束，跑一个跟踪任务"},
      {id:"y2_m3_t2", text:"对比：不同 horizon 对稳定性/计算量的影响"},
      {id:"y2_m3_t3", text:"写一页：为什么腿式/车辆都喜欢 MPC"},
    ],
    pitfalls:[
      "MPC 写成“开环优化”而不滚动更新",
      "实时性没考虑，仿真能跑实机跑不动",
    ],
    next:"继续 M10：刚体动力学（M,C,g）— 具身控制的基础。"
  });

  PAGES.y2_m4 = modulePage({
    title:"Year2-M10：刚体动力学（M(q), C(q,q̇), g(q)）",
    prefix:"y2_m4_",
    goals:[
      "能解释动力学方程每一项的意义",
      "能在仿真里提取/验证动力学量",
      "为 WBC/接触力优化打基础"
    ],
    learn:[
      "广义坐标 q, qdot, qddot",
      "惯性矩阵 M(q)",
      "科氏/离心项 C(q,qdot)qdot",
      "重力项 g(q)",
      "关节力矩 τ 与接触力"
    ],
    formulas:`
      \\[
        M(q)\\ddot{q} + C(q,\\dot{q})\\dot{q} + g(q) = \\tau
      \\]
    `,
    code:`
<pre><code>// 实践建议：在 MuJoCo/Drake 中
// 1) 读取/计算关节力矩、接触力
// 2) 给定 q,qdot,qddot 验证动力学一致性
</code></pre>
    `,
    papers:[
      {name:"Modern Robotics（动力学章节）", url:LINKS.modernRob, note:"动力学推导更体系化"},
      {name:"Drake（工具链）", url:LINKS.drake, note:"很适合做动力学与优化"},
    ],
    tasks:[
      {id:"y2_m4_t1", text:"在仿真中获取接触力/关节力矩并画曲线"},
      {id:"y2_m4_t2", text:"写一页：腿式机器人为何必须考虑接触力"},
      {id:"y2_m4_t3", text:"做一次实验：同样控制输入，不同地面摩擦，行为变化"},
    ],
    pitfalls:[
      "忽略接触约束，导致控制模型与现实不一致",
      "把动力学公式背下来但没做数值验证",
    ],
    next:"继续 M11：仿真平台（Isaac/MuJoCo/Drake）— 让你具身学习加速10倍。"
  });

  PAGES.y2_m5 = modulePage({
    title:"Year2-M11：仿真平台（Isaac Sim / MuJoCo / Drake）",
    prefix:"y2_m5_",
    goals:[
      "搭建至少一个仿真环境并跑通例程",
      "能加载 URDF/模型，运行控制回路",
      "为腿式机器人实验做准备"
    ],
    learn:[
      "Isaac Sim 基础：场景、关节、传感器、脚本",
      "MuJoCo 基础：MJCF、接触、渲染、Python API",
      "Drake 基础：系统图、优化、接触建模（可选）"
    ],
    formulas:`
      <div class="callout">
        仿真学习策略：<b>先跑通官方例程 → 改一个参数/控制器 → 写实验报告</b>。
      </div>
    `,
    code:`
<pre><code>// 最小目标：
// 1) 在 MuJoCo python 里加载一个简单模型
// 2) 每步：读状态 -> 算控制 -> 写控制 -> step()
// 3) 记录关节角/力矩/接触力并画图</code></pre>
    `,
    papers:[
      {name:"Isaac Sim Documentation", url:LINKS.isaacDocs, note:"官方文档"},
      {name:"MuJoCo Documentation", url:LINKS.mujocoDocs, note:"官方文档"},
      {name:"Drake Documentation", url:LINKS.drakeDocs, note:"官方文档"},
    ],
    tasks:[
      {id:"y2_m5_t1", text:"完成 Isaac Sim 安装并跑通一个官方 demo"},
      {id:"y2_m5_t2", text:"MuJoCo：加载模型 + 控制关节（最小闭环）+ 曲线记录"},
      {id:"y2_m5_t3", text:"写一份仿真笔记：如何复现实验（版本/脚本/参数）"},
    ],
    pitfalls:[
      "把大量时间花在安装而不做最小闭环",
      "不记录版本/依赖导致环境不可复现",
    ],
    next:"继续 M12：腿式机器人估计（接触 + IMU + 运动学）— 具身落地核心。"
  });

  PAGES.y2_m6 = modulePage({
    title:"Year2-M12：腿式机器人估计/接触模型（InEKF）",
    prefix:"y2_m6_",
    goals:[
      "理解腿式估计：IMU + 接触 + 运动学融合",
      "知道不可观测性：绝对位置、yaw 等",
      "能读懂 Contact-aided InEKF 的核心结论"
    ],
    learn:[
      "接触点约束（足端速度近似为0）",
      "基于 FK 的观测项",
      "Invariant EKF 基本思想（误差动力学更好）",
      "实验评估方式"
    ],
    formulas:`
      <div class="callout">
        腿式估计常见观测：<b>足端接触时，足端在世界系速度≈0</b>（加 FK 约束）。<br/>
        InEKF 的关键优势：误差动力学更“结构化”（更稳）。
      </div>
    `,
    code:`
<pre><code>// 你不必立刻完整实现 InEKF，但必须做：
// 1) 在 ESKF 框架里加入“接触速度=0”的观测
// 2) 用仿真数据验证：加接触观测后漂移明显降低</code></pre>
    `,
    papers:[
      {name:"Contact-aided InEKF（arXiv:1904.09251）", url:LINKS.inekf2019, note:"腿式估计经典"},
      {name:"Contact-aided InEKF（arXiv:1805.10410）", url:LINKS.inekf2018, note:"早期版本"},
    ],
    tasks:[
      {id:"y2_m6_t1", text:"写一页总结：腿式估计里“接触观测”是什么、何时有效、何时失效"},
      {id:"y2_m6_t2", text:"在你的 ESKF 中加入一个简化接触观测，并在仿真上对比漂移"},
      {id:"y2_m6_t3", text:"列出 3 个腿式估计的常见失败模式（打滑、误触地、时间偏差）"},
    ],
    pitfalls:[
      "假设接触永远可靠（打滑会直接把估计拉崩）",
      "FK 外参/关节编码器标定不准导致观测偏差",
    ],
    next:"Year3：系统工程 + 高级估计 + WBC + 作品集/影响力。"
  });

  // ---------- Year 3 Modules ----------
  PAGES.y3_m1 = modulePage({
    title:"Year3-M13：系统工程（实时/同步/延迟/资源）",
    prefix:"y3_m1_",
    goals:[
      "能排查系统级问题：时间戳、延迟、频率、资源",
      "把算法做成“可部署/可维护/可复现”的工程",
      "形成系统架构图与优化建议"
    ],
    learn:[
      "传感器时间戳与同步",
      "延迟对闭环控制的影响",
      "CPU/GPU/线程调度与实时性",
      "日志与回放（可复现实验链）"
    ],
    formulas:`
      <div class="callout">
        系统工程的指标：<b>频率、延迟、抖动、丢帧、资源占用</b>。<br/>
        你的目标：看到异常 → 立刻定位是算法还是系统。
      </div>
    `,
    code:`
<pre><code>// 你要做一个“系统健康监控最小工具”：
// 记录 topic 频率、端到端延迟、CPU/GPU占用、丢帧率
// 然后把这些指标和算法输出误差做关联分析。</code></pre>
    `,
    papers:[
      {name:"Autoware Documentation（架构/部署）", url:LINKS.autowareDoc, note:"系统工程实践场"},
    ],
    tasks:[
      {id:"y3_m1_t1", text:"做一次系统 profiling：频率/延迟/CPU，输出一页图表"},
      {id:"y3_m1_t2", text:"写一张系统架构图（含数据流、同步点、瓶颈）"},
      {id:"y3_m1_t3", text:"设计一套“复现实验”流程（版本+参数+数据+结果）"},
    ],
    pitfalls:[
      "只盯算法不看系统延迟/丢包",
      "缺少统一日志格式导致难以横向对比",
    ],
    next:"继续 M14：高级估计（Invariant EKF / 因子图），把你带到“高级工程师门槛”。"
  });

  PAGES.y3_m2 = modulePage({
    title:"Year3-M14：高级估计（Invariant EKF / 因子图）",
    prefix:"y3_m2_",
    goals:[
      "知道 InEKF 为什么更稳（误差动力学性质）",
      "理解因子图/平滑（LIO-SAM 路线）",
      "能在项目里做架构选择（滤波 vs 优化）"
    ],
    learn:[
      "Invariant EKF 的基本思想",
      "因子图：残差块、变量节点、边",
      "滑窗与边缘化",
      "鲁棒核与离群点处理"
    ],
    formulas:`
      <div class="callout">
        高级估计核心：<b>更好的误差建模 + 更强的非线性处理 + 更鲁棒的优化/滤波</b>。
      </div>
    `,
    code:`
<pre><code>// 实践路线（推荐）：
// 1) 把你现有 ESKF 变成“模块化”：状态/噪声/观测 可插拔
// 2) 用 LIO-SAM 跑一遍数据集并理解：因子是什么、优化变量是什么
// 3) 写一页对比：滤波 vs 优化（优缺点 & 适用场景）</code></pre>
    `,
    papers:[
      {name:"Contact-aided InEKF（arXiv）", url:LINKS.inekf2019, note:"InEKF 实例"},
      {name:"LIO-SAM（GitHub）", url:LINKS.liosam, note:"因子图路线代表"},
    ],
    tasks:[
      {id:"y3_m2_t1", text:"写一页：InEKF 与 ESKF 的关键差异（你理解的版本）"},
      {id:"y3_m2_t2", text:"跑 LIO-SAM 数据集，并画 ATE/轨迹图，记录参数与结果"},
      {id:"y3_m2_t3", text:"在你的系统里加入一个鲁棒策略（门限/鲁棒核）并验证"},
    ],
    pitfalls:[
      "把 InEKF 当成“换个名字的 EKF”而忽略误差结构",
      "优化系统不做边缘化管理导致计算爆炸",
    ],
    next:"继续 M15：WBC（Whole-Body Control）与接触力优化。"
  });

  PAGES.y3_m3 = modulePage({
    title:"Year3-M15：WBC/接触力优化（腿式核心）",
    prefix:"y3_m3_",
    goals:[
      "理解 WBC：把多个任务（姿态/CoM/足端）统一成优化",
      "会搭一个简化 WBC（QP）",
      "能解释接触约束与摩擦锥"
    ],
    learn:[
      "任务空间控制与优先级",
      "接触约束（足端不穿透、摩擦）",
      "QP 形式与实时解算",
      "和 MPC 的关系"
    ],
    formulas:`
      \\[
        \\min \\; \\|Ax-b\\|^2_W + \\lambda\\|x\\|^2
      \\]
      \\[
        \\text{s.t. } Cx \\le d \\quad (\\text{接触/摩擦/力矩约束})
      \\]
      <div class="callout">
        你不需要一开始就做“完整 WBC”，先做简化 QP：<b>站立平衡 + 足端力分配</b>。
      </div>
    `,
    code:`
<pre><code>// WBC 最小实现建议：
// 变量：接触力 f 或 关节加速度 qdd
// 目标：保持 CoM/姿态
// 约束：摩擦锥、法向力非负
// 工具：你可以用 Drake 的优化器先快速验证</code></pre>
    `,
    papers:[
      {name:"Drake（优化/接触建模）", url:LINKS.drakeDocs, note:"做 QP/WBC 很合适"},
      {name:"Underactuated Robotics", url:LINKS.underact, note:"动力学+优化控制基础"},
    ],
    tasks:[
      {id:"y3_m3_t1", text:"做一个简化 WBC：站立时分配双足接触力，满足摩擦约束"},
      {id:"y3_m3_t2", text:"把 WBC 跑在仿真里，记录 CoM/姿态误差曲线"},
      {id:"y3_m3_t3", text:"写一页：WBC 与 MPC 的联系与区别"},
    ],
    pitfalls:[
      "忽略摩擦约束导致仿真可行、现实不可行",
      "优化变量/约束选得太大导致实时性不够",
    ],
    next:"继续 M16：端到端/学习控制（选修，别太早陷进去）。"
  });

  PAGES.y3_m4 = modulePage({
    title:"Year3-M16：端到端/学习控制（选修）",
    prefix:"y3_m4_",
    goals:[
      "建立正确预期：学习控制不是替代估计/控制基础",
      "知道常见范式：模仿学习、强化学习、残差学习",
      "能在仿真中训练一个简单策略并评估泛化"
    ],
    learn:[
      "Sim2Real 差距与随机化",
      "Reward 设计与稳定性",
      "安全与约束（shielding）",
      "数据采集与评估"
    ],
    formulas:`
      <div class="callout">
        这一模块建议在你掌握估计+控制后再做，否则会变成“黑箱调参”。
      </div>
    `,
    code:`
<pre><code>// 最小任务：
// 在 MuJoCo 或 Isaac 中用现成示例训练一个小策略（走/站/跟踪）
// 然后做评估：不同地面摩擦/质量扰动下是否稳定</code></pre>
    `,
    papers:[
      {name:"MuJoCo 文档", url:LINKS.mujocoDocs, note:"训练环境常用"},
      {name:"Isaac Sim 文档", url:LINKS.isaacDocs, note:"具身训练与合成数据"},
    ],
    tasks:[
      {id:"y3_m4_t1", text:"跑一个现成训练示例并记录 reward/成功率"},
      {id:"y3_m4_t2", text:"做一次 domain randomization，观察泛化变化"},
      {id:"y3_m4_t3", text:"写一页：为什么学习控制需要系统/估计基础"},
    ],
    pitfalls:[
      "把 reward 调出来就以为“学会了”，但一换环境就崩",
      "忽略安全约束导致不可部署",
    ],
    next:"继续 M17：作品集/面试素材/技术影响力（把三年成果变成可展示资产）。"
  });

  PAGES.y3_m5 = modulePage({
    title:"Year3-M17：作品集/面试素材/技术影响力",
    prefix:"y3_m5_",
    goals:[
      "把学习变成“可验证产出”：报告、代码、复现实验",
      "形成面试可讲的 5 个项目故事",
      "建立技术影响力（文档/分享/复盘）"
    ],
    learn:[
      "如何写技术报告（结论-证据-复现）",
      "如何做 ablation（对比实验）",
      "如何准备面试：估计/控制/系统问答",
      "如何把工作问题沉淀为资产"
    ],
    formulas:`
      <div class="callout">
        你最终的竞争力：<b>能解决真实问题 + 有证据链 + 可复现 + 有作品集</b>。
      </div>
    `,
    code:`
<pre><code>// 建议你的 repo 结构：
// /notes   (学习笔记+公式)
// /code    (ESKF、MPC、工具库)
// /experiments (数据、脚本、结果图)
// /reports (PDF/Markdown 报告)
// /demo    (视频/截图/可复现步骤)</code></pre>
    `,
    papers:[
      {name:"Underactuated Robotics（作为引用/学习记录）", url:LINKS.underact, note:"你可以引用课程内容做支撑"},
    ],
    tasks:[
      {id:"y3_m5_t1", text:"整理 5 个可讲项目：问题-方法-结果-复现-反思"},
      {id:"y3_m5_t2", text:"把每个项目做成一页报告（含图表）"},
      {id:"y3_m5_t3", text:"准备面试问答：估计/控制/系统各 20 题（写出答案）"},
    ],
    pitfalls:[
      "只有代码没有结果图/指标",
      "只有结果没有复现步骤",
      "只讲做了什么，不讲为什么、怎么验证",
    ],
    next:"做完这一模块，你就具备“高级工程师可展示资产”。"
  });

  // Tracker page
  PAGES.tracker = {
    title:"进度与打卡",
    render(){
      const sections = [
        {name:"Year1（估计基础）", prefix:"y1_"},
        {name:"Year2（控制/动力学/仿真）", prefix:"y2_"},
        {name:"Year3（系统/高级/作品集）", prefix:"y3_"},
      ];
      const cards = sections.map(s=>{
        const c = computeCompletion(s.prefix);
        return `
          <div class="card">
            <h3>${s.name}</h3>
            <p class="muted">完成度：${c.done}/${c.total}（${c.rate}%）</p>
            <div class="progress">
              <div class="bar"><div style="width:${c.rate}%"></div></div>
              <span>${c.rate}%</span>
            </div>
          </div>
        `;
      }).join("");

      return `
        <div class="grid">${cards}</div>
        <div class="card">
          <h3>今日打卡（建议每天 10 分钟）</h3>
          <ul class="checklist">
            <li>今天做了什么（读/推/写/跑/测）？</li>
            <li>遇到的最大问题是什么？证据是什么？</li>
            <li>明天最小下一步是什么（可执行）？</li>
          </ul>
          <div class="hr"></div>
          <p class="muted">提示：勾选任务是“完成记录”，打卡是“过程记录”。两者结合最有效。</p>
        </div>
      `;
    }
  };

  // ---------- Router / UI ----------
  let currentPage = "home";

  function setActiveNav(page){
    $$(".navItem").forEach(b => b.classList.toggle("active", b.dataset.page === page));
  }

  function renderPage(page){
    const p = PAGES[page] || PAGES.home;
    currentPage = page;
    $("#pageTitle").textContent = p.title;
    $("#root").innerHTML = p.render();
    setActiveNav(page);

    // bind checklist checkboxes
    $$("input[type='checkbox'][data-check]").forEach(cb=>{
      cb.addEventListener("change", (e)=>{
        const id = cb.dataset.check;
        setChecked(id, cb.checked);
        // update top progress bars by re-rendering page quickly
        // but avoid losing scroll too often; only update local page completion text if module
      });
    });

    // rerender MathJax
    if (window.MathJax && window.MathJax.typesetPromise){
      window.MathJax.typesetPromise();
    }
  }

  // Nav clicks
  $$(".navItem").forEach(btn=>{
    btn.addEventListener("click", ()=> renderPage(btn.dataset.page));
  });

  // Search
  const searchInput = $("#q");
  function doSearch(){
    const term = searchInput.value.trim().toLowerCase();
    if (!term){
      // show all nav items
      $$(".navItem").forEach(b => b.style.display = "");
      return;
    }
    $$(".navItem").forEach(b=>{
      const t = b.textContent.toLowerCase();
      b.style.display = t.includes(term) ? "" : "none";
    });
  }
  searchInput.addEventListener("input", doSearch);

  // Ctrl+K focus search
  document.addEventListener("keydown", (e)=>{
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k"){
      e.preventDefault();
      searchInput.focus();
    }
  });

  // Expand/collapse details
  $("#expandAll").addEventListener("click", ()=>{
    $$("details").forEach(d=> d.open = true);
  });
  $("#collapseAll").addEventListener("click", ()=>{
    $$("details").forEach(d=> d.open = false);
  });

  // Reset progress
  $("#resetProgress").addEventListener("click", ()=>{
    if (!confirm("确定清空所有勾选进度？此操作不可撤销。")) return;
    localStorage.removeItem(storageKey);
    renderPage(currentPage);
  });

  // Initial render
  renderPage("home");
</script>

</body>
</html>